<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AI多角査定エンジン v5.0 (Pro Edition)</title>
    
    <script src="https://cdn.tailwindcss.com"></script>
    
    <script crossorigin src="https://unpkg.com/react@18/umd/react.development.js"></script>
    <script crossorigin src="https://unpkg.com/react-dom@18/umd/react-dom.development.js"></script>
    
    <script src="https://unpkg.com/@babel/standalone/babel.min.js"></script>

    <link href="https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">

    <script src="https://unpkg.com/recharts@2.5.0/umd/Recharts.js"></script>

    <script>
        tailwind.config = {
            theme: {
                extend: {
                    fontFamily: {
                        sans: ['Inter', 'Noto Sans JP', 'sans-serif'],
                    },
                    colors: {
                        slate: { 850: '#1e293b', 950: '#020617' },
                        primary: { 50: '#eff6ff', 100: '#dbeafe', 500: '#3b82f6', 600: '#2563eb', 700: '#1d4ed8' },
                    },
                    animation: {
                        'slide-in-right': 'slideInRight 0.4s cubic-bezier(0.16, 1, 0.3, 1)',
                        'fade-in': 'fadeIn 0.5s ease-out',
                        'pulse-slow': 'pulse 3s cubic-bezier(0.4, 0, 0.6, 1) infinite',
                    },
                    keyframes: {
                        slideInRight: {
                            'from': { transform: 'translateX(100%)', opacity: '0' },
                            'to': { transform: 'translateX(0)', opacity: '1' },
                        },
                        fadeIn: {
                            'from': { opacity: '0', transform: 'translateY(10px)' },
                            'to': { opacity: '1', transform: 'translateY(0)' },
                        }
                    }
                }
            }
        }
    </script>

    <style>
        body {
            background-color: #f8fafc;
            color: #0f172a;
            overflow: hidden; /* App container handles scroll */
        }
        
        /* Glassmorphism Utilities */
        .glass-panel {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(12px);
            border: 1px solid rgba(255, 255, 255, 0.5);
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.05), 0 2px 4px -1px rgba(0, 0, 0, 0.03);
        }
        
        .glass-dark {
            background: rgba(15, 23, 42, 0.95);
            backdrop-filter: blur(12px);
        }

        /* Custom Scrollbar */
        .custom-scroll::-webkit-scrollbar { width: 6px; height: 6px; }
        .custom-scroll::-webkit-scrollbar-track { background: transparent; }
        .custom-scroll::-webkit-scrollbar-thumb { background: #cbd5e1; border-radius: 3px; }
        .custom-scroll::-webkit-scrollbar-thumb:hover { background: #94a3b8; }

        /* Grid Pattern for Maps */
        .bg-grid-tech {
            background-image: linear-gradient(to right, #e2e8f0 1px, transparent 1px),
                              linear-gradient(to bottom, #e2e8f0 1px, transparent 1px);
            background-size: 24px 24px;
        }
    </style>
</head>
<body>
    <div id="root"></div>

    <script type="text/babel">
        const { useState, useMemo, useEffect, Component, useRef } = React;
        const { ResponsiveContainer, RadarChart, PolarGrid, PolarAngleAxis, PolarRadiusAxis, Radar, AreaChart, Area, XAxis, YAxis, Tooltip, CartesianGrid } = window.Recharts;

        // --- Mock Data Generator ---
        const generateTrendData = (base, volatility) => {
            return Array.from({ length: 12 }, (_, i) => ({
                month: `${i + 1}月`,
                value: Math.min(100, Math.max(0, base + (Math.random() - 0.5) * volatility))
            }));
        };

        const MOCK_GUARDS = [
            { 
                id: 1, 
                name: "佐藤 健一", 
                id_code: "EMP-2021-0045",
                age: 45, 
                rank: "警備士長", 
                avatarColor: "bg-blue-600",
                riskLevel: "high",
                riskReason: "給与乖離・通勤負荷", 
                metrics: { 
                    attendance: 98, profit: 92, stress: 90, sentiment: 35, engagement: 42,
                    history_engagement: generateTrendData(50, 20) 
                },
                tags: ["通勤負荷大", "相場乖離", "金銭不満"], 
                currentWage: 1100, 
                marketWage: 1250, 
                financial: { 
                    unitPrice: 2200, 
                    allowance: 15000, 
                    negotiationSuccessRate: 65,
                    client: "大和建設(株) 第3現場" 
                }, 
                placement: { 
                    current: "交通誘導 (遠方)", 
                    ideal: "施設警備 (近隣)", 
                    commuteTime: 95, 
                    idealCommuteTime: 30, 
                    distanceKm: 42 
                }, 
                skills: { 
                    acquired: ["交通誘導2級", "雑踏警備2級"], 
                    next: "指導教育責任者", 
                    progress: 60 
                }, 
                history: [
                    { date: "2024.12.15", type: "alert", title: "日報アラート", detail: "「今の現場は体力的に限界」との記述あり。" },
                    { date: "2024.11.20", type: "neg", title: "給与交渉", detail: "面談にてベースアップの要望あり。" },
                    { date: "2024.10.01", type: "neu", title: "配置転換", detail: "現場Aから現在の遠方現場へ異動。" }
                ],
                aiAction: { type: "placement", label: "至急配置転換", score: 92, detail: "自宅30分圏内の「B倉庫」へ異動推奨" } 
            },
            { 
                id: 2, 
                name: "田中 優子", 
                id_code: "EMP-2023-0102",
                age: 28, 
                rank: "警備員", 
                avatarColor: "bg-rose-500",
                riskLevel: "medium", 
                riskReason: "キャリア不透明感",
                metrics: { 
                    attendance: 92, profit: 60, stress: 40, sentiment: 75, engagement: 68,
                    history_engagement: generateTrendData(70, 10)
                },
                tags: ["成長意欲", "資格取得中"], 
                currentWage: 1050, 
                marketWage: 1100, 
                financial: { 
                    unitPrice: 1900, 
                    allowance: 5000, 
                    negotiationSuccessRate: 20,
                    client: "鈴木興業 イベント部" 
                }, 
                placement: { 
                    current: "イベント警備", 
                    ideal: "イベント警備", 
                    commuteTime: 45, 
                    idealCommuteTime: 45, 
                    distanceKm: 15 
                }, 
                skills: { 
                    acquired: [], 
                    next: "雑踏警備2級", 
                    progress: 85 
                }, 
                history: [
                    { date: "2025.01.10", type: "pos", title: "資格勉強", detail: "社内勉強会への参加率100%。" },
                    { date: "2024.08.01", type: "neu", title: "入社", detail: "未経験枠で採用。" }
                ],
                aiAction: { type: "skill", label: "資格取得支援", score: 88, detail: "雑踏2級取得で単価+¥200交渉可能" } 
            },
            { 
                id: 3, 
                name: "高橋 誠", 
                id_code: "EMP-2019-0012",
                age: 35, 
                rank: "警備副士長", 
                avatarColor: "bg-slate-600",
                riskLevel: "medium", 
                riskReason: "人間関係トラブル",
                metrics: { 
                    attendance: 88, profit: 78, stress: 70, sentiment: 55, engagement: 50,
                    history_engagement: generateTrendData(60, 30)
                },
                tags: ["現場クレーム", "配置不満"], 
                currentWage: 1150, 
                marketWage: 1200, 
                financial: { 
                    unitPrice: 2100, 
                    allowance: 10000, 
                    negotiationSuccessRate: 40,
                    client: "西区商業施設" 
                }, 
                placement: { 
                    current: "施設警備", 
                    ideal: "交通誘導", 
                    commuteTime: 50, 
                    idealCommuteTime: 50, 
                    distanceKm: 22 
                }, 
                skills: { 
                    acquired: ["施設警備2級"], 
                    next: "交通誘導2級", 
                    progress: 10 
                }, 
                history: [
                    { date: "2025.01.05", type: "alert", title: "クレーム発生", detail: "現場監督との口論報告あり。" },
                    { date: "2024.11.12", type: "neg", title: "遅刻", detail: "連絡なしの遅刻2回。" }
                ],
                aiAction: { type: "interview", label: "緊急面談", score: 95, detail: "現場監督との相性不一致をヒアリング" } 
            },
            { 
                id: 4, 
                name: "鈴木 一郎", 
                id_code: "EMP-2015-0001",
                age: 62, 
                rank: "指導教育責任者", 
                avatarColor: "bg-emerald-600",
                riskLevel: "low", 
                riskReason: "安定稼働中",
                metrics: { 
                    attendance: 100, profit: 85, stress: 30, sentiment: 90, engagement: 88,
                    history_engagement: generateTrendData(90, 5)
                },
                tags: ["ロールモデル", "安定"], 
                currentWage: 1500, 
                marketWage: 1450, 
                financial: { 
                    unitPrice: 3000, 
                    allowance: 30000, 
                    negotiationSuccessRate: 10,
                    client: "本社ビル" 
                }, 
                placement: { 
                    current: "施設警備", 
                    ideal: "施設警備", 
                    commuteTime: 20, 
                    idealCommuteTime: 20, 
                    distanceKm: 5 
                }, 
                skills: { 
                    acquired: ["指導教", "施設1級", "交通2級"], 
                    next: "なし", 
                    progress: 100 
                }, 
                history: [
                    { date: "2024.12.20", type: "pos", title: "表彰", detail: "新人教育担当として社長賞受賞。" }
                ],
                aiAction: { type: "bonus", label: "特別賞与", score: 60, detail: "指導業務への貢献度を評価" } 
            }
        ];

        // --- Custom Icons (SVG) ---
        const Icon = ({ name, size = 18, className = "", strokeWidth = 2 }) => {
            const icons = {
                Users: <path d="M16 21v-2a4 4 0 0 0-4-4H6a4 4 0 0 0-4 4v2"/><circle cx="9" cy="7" r="4"/><path d="M22 21v-2a4 4 0 0 0-3-3.87"/><path d="M16 3.13a4 4 0 0 1 0 7.75"/>,
                Activity: <polyline points="22 12 18 12 15 21 9 3 6 12 2 12"/>,
                MapPin: <path d="M21 10c0 7-9 13-9 13s-9-6-9-13a9 9 0 0 1 18 0z"/><circle cx="12" cy="10" r="3"/>,
                DollarSign: <line x1="12" y1="1" x2="12" y2="23"/><path d="M17 5H9.5a3.5 3.5 0 0 0 0 7h5a3.5 3.5 0 0 1 0 7H6"/>,
                Briefcase: <rect width="20" height="14" x="2" y="7" rx="2" ry="2"/><path d="M16 21V5a2 2 0 0 0-2-2h-4a2 2 0 0 0-2 2v16"/>,
                BookOpen: <path d="M2 3h6a4 4 0 0 1 4 4v14a3 3 0 0 0-3-3H2z"/><path d="M22 3h-6a4 4 0 0 0-4 4v14a3 3 0 0 1 3-3h7z"/>,
                AlertTriangle: <path d="m21.73 18-8-14a2 2 0 0 0-3.48 0l-8 14A2 2 0 0 0 4 21h16a2 2 0 0 0 1.73-3Z"/><line x1="12" y1="9" x2="12" y2="13"/><line x1="12" y1="17" x2="12.01" y2="17"/>,
                CheckCircle: <path d="M22 11.08V12a10 10 0 1 1-5.93-9.14"/><polyline points="22 4 12 14.01 9 11.01"/>,
                X: <line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/>,
                ChevronRight: <polyline points="9 18 15 12 9 6"/>,
                Search: <circle cx="11" cy="11" r="8"/><line x1="21" y1="21" x2="16.65" y2="16.65"/>,
                Filter: <polygon points="22 3 2 3 10 12.46 10 19 14 21 14 12.46 22 3"/>,
                Clock: <circle cx="12" cy="12" r="10"/><polyline points="12 6 12 12 16 14"/>,
                TrendingUp: <polyline points="23 6 13.5 15.5 8.5 10.5 1 18"/><polyline points="17 6 23 6 23 12"/>,
                Sparkles: <path d="m12 3-1.912 5.813a2 2 0 0 1-1.275 1.275L3 12l5.813 1.912a2 2 0 0 1 1.275 1.275L12 21l1.912-5.813a2 2 0 0 1 1.275-1.275L21 12l-5.813-1.912a2 2 0 0 1-1.275-1.275L12 3Z"/>,
                LayoutDashboard: <rect width="7" height="9" x="3" y="3" rx="1"/><rect width="7" height="5" x="14" y="3" rx="1"/><rect width="7" height="9" x="14" y="12" rx="1"/><rect width="7" height="5" x="3" y="16" rx="1"/>,
                Settings: <path d="M12.22 2h-.44a2 2 0 0 0-2 2v.18a2 2 0 0 1-1 1.73l-.43.25a2 2 0 0 1-2 0l-.15-.08a2 2 0 0 0-2.73.73l-.22.38a2 2 0 0 0 .73 2.73l.15.1a2 2 0 0 1 1 1.72v.51a2 2 0 0 1-1 1.72l-.15.1a2 2 0 0 0-.73 2.73l.22.38a2 2 0 0 0 2.73.73l.15-.08a2 2 0 0 1 2 0l.43.25a2 2 0 0 1 1 1.73V20a2 2 0 0 0 2 2h.44a2 2 0 0 0 2-2v-.18a2 2 0 0 1 1-1.73l.43-.25a2 2 0 0 1 2 0l.15.08a2 2 0 0 0 2.73-.73l.22-.38a2 2 0 0 0-.73-2.73l-.15-.1a2 2 0 0 1-1-1.72v-.51a2 2 0 0 1 1-1.72l.15-.1a2 2 0 0 0 .73-2.73l-.22-.38a2 2 0 0 0-2.73-.73l-.15.08a2 2 0 0 1-2 0l-.43-.25a2 2 0 0 1-1-1.73V4a2 2 0 0 0-2-2z"/><circle cx="12" cy="12" r="3"/>,
                Brain: <path d="M9.5 2A2.5 2.5 0 0 1 12 4.5v15a2.5 2.5 0 0 1-4.96.44 2.5 2.5 0 0 1-2.96-3.08 3 3 0 0 1-.34-5.58 2.5 2.5 0 0 1 1.32-4.24 2.5 2.5 0 0 1 1.98-3A2.5 2.5 0 0 1 9.5 2Z"/><path d="M14.5 2A2.5 2.5 0 0 0 12 4.5v15a2.5 2.5 0 0 0 4.96.44 2.5 2.5 0 0 0 2.96-3.08 3 3 0 0 0 .34-5.58 2.5 2.5 0 0 0-1.32-4.24 2.5 2.5 0 0 0-1.98-3A2.5 2.5 0 0 0 14.5 2Z"/>,
                ArrowRight: <line x1="5" y1="12" x2="19" y2="12"/><polyline points="12 5 19 12 12 19"/>,
                Send: <line x1="22" y1="2" x2="11" y2="13"/><polygon points="22 2 15 22 11 13 2 9 22 2"/>
            };
            // Add wrapper g for multiple paths/shapes
            const content = icons[name] || <circle cx="12" cy="12" r="10"/>;
            
            return (
                <svg xmlns="http://www.w3.org/2000/svg" width={size} height={size} viewBox="0 0 24 24" fill="none" stroke="currentColor" strokeWidth={strokeWidth} strokeLinecap="round" strokeLinejoin="round" className={className}>
                    <g>{content}</g>
                </svg>
            );
        };

        // --- Sub-Components ---

        const Badge = ({ children, color = "slate", icon }) => (
            <span className={`inline-flex items-center gap-1.5 px-2.5 py-1 rounded-md text-[11px] font-bold uppercase tracking-wide border ${
                color === 'red' ? 'bg-red-50 text-red-700 border-red-200' :
                color === 'emerald' ? 'bg-emerald-50 text-emerald-700 border-emerald-200' :
                color === 'blue' ? 'bg-blue-50 text-blue-700 border-blue-200' :
                color === 'amber' ? 'bg-amber-50 text-amber-700 border-amber-200' :
                'bg-slate-100 text-slate-600 border-slate-200'
            }`}>
                {icon && <Icon name={icon} size={10} />}
                {children}
            </span>
        );

        // --- Detail Components ---

        const FinancialSimulator = ({ guard }) => {
            const [adjustment, setAdjustment] = useState(0);
            const [includeWelfare, setIncludeWelfare] = useState(true);
            const [negotiationPower, setNegotiationPower] = useState(guard.financial.negotiationSuccessRate);
            
            const baseWage = guard.currentWage + adjustment;
            const overhead = 250; 
            const welfareRate = includeWelfare ? 0.16 : 0;
            const allowance = Math.round(guard.financial.allowance / 160);
            const welfareCost = Math.round((baseWage + allowance) * welfareRate);
            const totalCost = baseWage + allowance + welfareCost + overhead;
            const profit = guard.financial.unitPrice - totalCost;
            const profitMargin = (profit / guard.financial.unitPrice) * 100;

            // AI Simulation Logic
            useEffect(() => {
                // Simple logic: higher wage = lower negotiation success unless profit is still high
                let newPower = guard.financial.negotiationSuccessRate;
                if (adjustment > 50) newPower -= 15;
                if (adjustment > 100) newPower -= 20;
                if (profitMargin < 10) newPower -= 30; // Client resists if agency margin is low (implies high markup)
                setNegotiationPower(Math.max(5, Math.min(95, newPower)));
            }, [adjustment, profitMargin]);

            return (
                <div className="space-y-6 animate-fade-in">
                    {/* Top Stats */}
                    <div className="grid grid-cols-3 gap-4">
                        <div className="p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                            <div className="text-xs text-slate-500 font-medium mb-1">現在の利益率</div>
                            <div className="text-2xl font-bold text-slate-800">
                                {profitMargin.toFixed(1)}%
                                <span className={`text-xs ml-2 ${profitMargin > 15 ? 'text-emerald-600' : 'text-red-600'}`}>
                                    {profitMargin > 15 ? '健全' : '要改善'}
                                </span>
                            </div>
                        </div>
                        <div className="p-4 bg-white rounded-xl border border-slate-200 shadow-sm">
                            <div className="text-xs text-slate-500 font-medium mb-1">AI交渉成功予測</div>
                            <div className="flex items-end gap-2">
                                <div className="text-2xl font-bold text-blue-600">{negotiationPower}%</div>
                                <div className="h-1.5 w-16 bg-slate-100 rounded-full mb-2 overflow-hidden">
                                    <div className="h-full bg-blue-500 transition-all duration-500" style={{ width: `${negotiationPower}%` }}></div>
                                </div>
                            </div>
                        </div>
                        <div className="p-4 bg-gradient-to-br from-indigo-600 to-blue-700 text-white rounded-xl shadow-lg shadow-indigo-200">
                            <div className="text-xs text-indigo-100 font-medium mb-1">推奨アクション</div>
                            <div className="font-bold text-sm flex items-center gap-1">
                                <Icon name="Sparkles" size={14} className="text-yellow-300" />
                                {negotiationPower > 60 ? '強気の単価交渉可' : 'まず配置転換を優先'}
                            </div>
                        </div>
                    </div>

                    {/* Simulator Controls */}
                    <div className="p-6 bg-slate-50 rounded-xl border border-slate-200">
                        <h4 className="text-sm font-bold text-slate-800 mb-6 flex items-center gap-2">
                            <Icon name="Settings" size={16} className="text-slate-400" />
                            賃金・コストシミュレーター
                        </h4>
                        
                        <div className="space-y-6">
                            <div>
                                <div className="flex justify-between mb-2">
                                    <label className="text-xs font-bold text-slate-500">時給調整 (現在: ¥{guard.currentWage})</label>
                                    <span className="text-sm font-bold text-blue-600">
                                        {adjustment > 0 ? '+' : ''}{adjustment}円
                                    </span>
                                </div>
                                <input 
                                    type="range" min="-50" max="300" step="10" value={adjustment} 
                                    onChange={(e) => setAdjustment(Number(e.target.value))}
                                    className="w-full h-2 bg-slate-200 rounded-lg appearance-none cursor-pointer accent-blue-600"
                                />
                                <div className="flex justify-between text-[10px] text-slate-400 mt-1">
                                    <span>現状維持</span>
                                    <span>市場相場 (¥{guard.marketWage})</span>
                                    <span>+300円</span>
                                </div>
                            </div>

                            <div className="flex items-center justify-between p-3 bg-white rounded border border-slate-200">
                                <div className="flex items-center gap-2">
                                    <input type="checkbox" checked={includeWelfare} onChange={(e) => setIncludeWelfare(e.target.checked)} className="rounded text-blue-600 focus:ring-blue-500" />
                                    <span className="text-sm text-slate-700">法定福利費 (16%) を計算に含める</span>
                                </div>
                            </div>

                            {/* Waterfall Visualization */}
                            <div className="space-y-2">
                                <div className="text-xs font-bold text-slate-500 mb-2">収益構造内訳 (単価 ¥{guard.financial.unitPrice})</div>
                                <div className="h-10 flex w-full rounded-md overflow-hidden text-[10px] font-bold text-white leading-none">
                                    <div style={{ width: `${(baseWage / guard.financial.unitPrice) * 100}%` }} className="bg-slate-400 flex items-center justify-center border-r border-white/20">基本給</div>
                                    <div style={{ width: `${(allowance / guard.financial.unitPrice) * 100}%` }} className="bg-slate-300 flex items-center justify-center border-r border-white/20">手当</div>
                                    <div style={{ width: `${(welfareCost / guard.financial.unitPrice) * 100}%` }} className="bg-slate-200 text-slate-500 flex items-center justify-center border-r border-white/20">福利</div>
                                    <div style={{ width: `${(overhead / guard.financial.unitPrice) * 100}%` }} className="bg-slate-100 text-slate-400 flex items-center justify-center border-r border-white/20">管</div>
                                    <div style={{ flex: 1 }} className={`${profit > 0 ? 'bg-emerald-500' : 'bg-red-500'} flex items-center justify-center`}>
                                        利益 ¥{profit}
                                    </div>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const AdvancedMap = ({ guard }) => {
            return (
                <div className="h-full flex flex-col animate-fade-in">
                    <div className="flex items-center justify-between mb-4">
                        <div className="flex gap-4">
                            <div className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-slate-400"></span>
                                <span className="text-xs text-slate-500">現在地: {guard.placement.commuteTime}分 (高負荷)</span>
                            </div>
                            <div className="flex items-center gap-2">
                                <span className="w-2 h-2 rounded-full bg-emerald-500"></span>
                                <span className="text-xs text-slate-500">推奨地: {guard.placement.idealCommuteTime}分 (最適)</span>
                            </div>
                        </div>
                    </div>

                    <div className="relative flex-1 bg-slate-50 rounded-xl border border-slate-200 overflow-hidden bg-grid-tech group">
                        {/* Simulated Map SVG */}
                        <svg className="absolute inset-0 w-full h-full" preserveAspectRatio="none">
                            <defs>
                                <pattern id="grid" width="40" height="40" patternUnits="userSpaceOnUse">
                                    <path d="M 40 0 L 0 0 0 40" fill="none" stroke="#e2e8f0" strokeWidth="1"/>
                                </pattern>
                            </defs>
                            <rect width="100%" height="100%" fill="url(#grid)" />
                            
                            {/* Route: Home to Current (High Stress) */}
                            <path d="M 150 250 Q 300 150 450 100" fill="none" stroke="#94a3b8" strokeWidth="4" strokeDasharray="8 4" className="animate-pulse" />
                            <path d="M 150 250 Q 300 150 450 100" fill="none" stroke="#ef4444" strokeWidth="2" strokeDasharray="8 4" opacity="0.6" />

                            {/* Route: Home to Ideal (Low Stress) */}
                            <path d="M 150 250 Q 200 350 250 400" fill="none" stroke="#10b981" strokeWidth="3" />
                            
                            {/* Zones */}
                            <circle cx="150" cy="250" r="100" fill="#3b82f6" fillOpacity="0.05" stroke="#3b82f6" strokeWidth="1" strokeDasharray="4 4" />
                            <text x="160" y="340" className="text-[10px] fill-blue-400 font-bold">30分圏内</text>
                        </svg>

                        {/* Pins */}
                        {/* Home */}
                        <div className="absolute top-[230px] left-[130px] flex flex-col items-center z-10 group-hover:scale-110 transition-transform">
                            <div className="w-10 h-10 bg-blue-600 rounded-full flex items-center justify-center text-white shadow-lg border-4 border-white">
                                <Icon name="Home" size={16} />
                            </div>
                            <div className="bg-white px-2 py-1 rounded shadow-md text-xs font-bold mt-1">自宅</div>
                        </div>

                        {/* Current Work */}
                        <div className="absolute top-[80px] left-[430px] flex flex-col items-center z-10 opacity-70">
                            <div className="w-8 h-8 bg-slate-500 rounded-full flex items-center justify-center text-white shadow-lg border-2 border-white">
                                <Icon name="Briefcase" size={14} />
                            </div>
                            <div className="bg-white px-2 py-1 rounded shadow-md text-[10px] font-bold mt-1 text-slate-500">現在: {guard.placement.current}</div>
                            <div className="mt-1 px-2 py-0.5 bg-red-100 text-red-600 text-[10px] rounded font-bold">ストレス高</div>
                        </div>

                        {/* Ideal Work */}
                        <div className="absolute top-[380px] left-[230px] flex flex-col items-center z-20 animate-bounce">
                            <div className="w-10 h-10 bg-emerald-500 rounded-full flex items-center justify-center text-white shadow-xl border-4 border-emerald-100">
                                <Icon name="CheckCircle" size={20} />
                            </div>
                            <div className="bg-white px-3 py-1.5 rounded shadow-lg text-xs font-bold mt-1 text-emerald-700 border border-emerald-100">
                                推奨: {guard.aiAction.detail.split('「')[1]?.split('」')[0] || 'B倉庫'}
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        const Timeline = ({ history }) => (
            <div className="space-y-0 relative pb-10">
                <div className="absolute left-4 top-2 bottom-0 w-0.5 bg-slate-200"></div>
                {history.map((event, i) => (
                    <div key={i} className="relative pl-10 py-3 group">
                        <div className={`absolute left-[9px] top-4 w-3.5 h-3.5 rounded-full border-2 border-white shadow-sm z-10 ${
                            event.type === 'alert' ? 'bg-red-500' :
                            event.type === 'pos' ? 'bg-emerald-500' :
                            event.type === 'neg' ? 'bg-amber-500' : 'bg-slate-400'
                        }`}></div>
                        <div className="bg-white p-4 rounded-lg border border-slate-200 shadow-sm hover:shadow-md transition-shadow group-hover:border-blue-200">
                            <div className="flex justify-between items-start mb-1">
                                <span className="text-xs font-bold text-slate-400">{event.date}</span>
                                {event.type === 'alert' && <span className="text-[10px] font-bold bg-red-100 text-red-600 px-1.5 py-0.5 rounded">Risk</span>}
                            </div>
                            <div className="font-bold text-sm text-slate-800 mb-1">{event.title}</div>
                            <div className="text-xs text-slate-600 leading-relaxed">{event.detail}</div>
                        </div>
                    </div>
                ))}
            </div>
        );

        // --- Main Detail Drawer ---
        const DetailDrawer = ({ guard, onClose }) => {
            const [activeTab, setActiveTab] = useState("overview");

            if (!guard) return null;

            const tabs = [
                { id: 'overview', label: '総合分析', icon: 'Brain' },
                { id: 'financial', label: '財務・処遇', icon: 'DollarSign' },
                { id: 'placement', label: '配置マップ', icon: 'MapPin' },
                { id: 'history', label: '履歴・予兆', icon: 'Clock' }
            ];

            return (
                <div className="fixed inset-0 z-50 flex justify-end bg-slate-900/40 backdrop-blur-sm transition-all" onClick={onClose}>
                    <div className="w-full max-w-[1000px] bg-[#f8fafc] h-full shadow-2xl animate-slide-in-right flex flex-col border-l border-white/20" onClick={e => e.stopPropagation()}>
                        
                        {/* Header Area */}
                        <div className="bg-white px-8 py-6 border-b border-slate-200 shrink-0">
                            <div className="flex justify-between items-start mb-6">
                                <div className="flex items-center gap-5">
                                    <div className={`w-20 h-20 rounded-2xl flex items-center justify-center text-3xl font-bold text-white shadow-lg ${guard.avatarColor}`}>
                                        {guard.name[0]}
                                    </div>
                                    <div>
                                        <div className="flex items-center gap-3 mb-1">
                                            <h2 className="text-2xl font-bold text-slate-800">{guard.name}</h2>
                                            <Badge>{guard.rank}</Badge>
                                            <span className="text-xs text-slate-400 font-mono">{guard.id_code}</span>
                                        </div>
                                        <div className="flex gap-6 text-sm text-slate-500">
                                            <div className="flex items-center gap-1.5"><Icon name="Briefcase" size={14} /> {guard.placement.current}</div>
                                            <div className="flex items-center gap-1.5"><Icon name="Activity" size={14} /> {guard.age}歳</div>
                                        </div>
                                    </div>
                                </div>
                                <div className="flex gap-4">
                                    <div className="text-right">
                                        <div className="text-[10px] text-slate-400 font-bold uppercase mb-1">Risk Score</div>
                                        <div className={`text-2xl font-black ${guard.riskLevel === 'high' ? 'text-red-600' : 'text-amber-500'}`}>
                                            {guard.riskLevel === 'high' ? 'High' : 'Medium'}
                                        </div>
                                    </div>
                                    <button onClick={onClose} className="w-10 h-10 flex items-center justify-center rounded-full hover:bg-slate-100 text-slate-400 transition">
                                        <Icon name="X" size={24} />
                                    </button>
                                </div>
                            </div>

                            {/* Navigation Tabs */}
                            <div className="flex gap-1">
                                {tabs.map(tab => (
                                    <button 
                                        key={tab.id}
                                        onClick={() => setActiveTab(tab.id)}
                                        className={`flex items-center gap-2 px-5 py-3 rounded-t-lg text-sm font-bold transition-all border-b-2 ${
                                            activeTab === tab.id 
                                            ? 'bg-slate-50 border-blue-600 text-blue-700' 
                                            : 'bg-transparent border-transparent text-slate-500 hover:text-slate-700 hover:bg-slate-50'
                                        }`}
                                    >
                                        <Icon name={tab.icon} size={16} />
                                        {tab.label}
                                    </button>
                                ))}
                            </div>
                        </div>

                        {/* Scrollable Content Area */}
                        <div className="flex-1 overflow-y-auto custom-scroll p-8">
                            
                            {/* AI Insight Box (Always Visible) */}
                            <div className="mb-8 bg-gradient-to-r from-indigo-50 to-blue-50 border border-blue-100 p-5 rounded-xl flex gap-4 items-start shadow-sm">
                                <div className="p-2 bg-white rounded-lg shadow-sm text-blue-600">
                                    <Icon name="Sparkles" size={20} />
                                </div>
                                <div>
                                    <h4 className="text-sm font-bold text-blue-900 mb-1">AI Action Insight</h4>
                                    <p className="text-sm text-blue-800 leading-relaxed">
                                        {guard.riskReason}のため、<span className="font-bold underline">{guard.aiAction.label}</span>が最も効果的です。
                                        {guard.aiAction.detail}。予測成功率は<span className="font-bold">{guard.aiAction.score}%</span>です。
                                    </p>
                                </div>
                            </div>

                            {activeTab === 'overview' && (
                                <div className="grid grid-cols-2 gap-8 animate-fade-in">
                                    <div className="space-y-6">
                                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <h3 className="text-sm font-bold text-slate-800 mb-4">4軸分析レーダー</h3>
                                            <div className="h-64">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <RadarChart cx="50%" cy="50%" outerRadius="80%" data={[
                                                        { subject: '勤怠安定', A: guard.metrics.attendance },
                                                        { subject: '収益貢献', A: guard.metrics.profit },
                                                        { subject: '低ストレス', A: 100 - guard.metrics.stress },
                                                        { subject: '組織エンゲージ', A: guard.metrics.engagement },
                                                        { subject: '感情分析', A: guard.metrics.sentiment },
                                                    ]}>
                                                        <PolarGrid stroke="#e2e8f0" />
                                                        <PolarAngleAxis dataKey="subject" tick={{ fontSize: 11, fill: '#64748b', fontWeight: 600 }} />
                                                        <PolarRadiusAxis angle={30} domain={[0, 100]} tick={false} axisLine={false} />
                                                        <Radar name="Score" dataKey="A" stroke="#2563eb" fill="#3b82f6" fillOpacity={0.25} />
                                                        <Tooltip />
                                                    </RadarChart>
                                                </ResponsiveContainer>
                                            </div>
                                        </div>
                                    </div>
                                    <div className="space-y-6">
                                        <div className="bg-white p-6 rounded-xl border border-slate-200 shadow-sm">
                                            <h3 className="text-sm font-bold text-slate-800 mb-4">エンゲージメント推移 (過去12ヶ月)</h3>
                                            <div className="h-40">
                                                <ResponsiveContainer width="100%" height="100%">
                                                    <AreaChart data={guard.metrics.history_engagement}>
                                                        <defs>
                                                            <linearGradient id="colorEng" x1="0" y1="0" x2="0" y2="1">
                                                                <stop offset="5%" stopColor="#3b82f6" stopOpacity={0.1}/>
                                                                <stop offset="95%" stopColor="#3b82f6" stopOpacity={0}/>
                                                            </linearGradient>
                                                        </defs>
                                                        <CartesianGrid strokeDasharray="3 3" vertical={false} stroke="#f1f5f9" />
                                                        <XAxis dataKey="month" hide />
                                                        <YAxis domain={[0, 100]} hide />
                                                        <Tooltip contentStyle={{ borderRadius: '8px', border: 'none', boxShadow: '0 4px 6px -1px rgba(0,0,0,0.1)' }} />
                                                        <Area type="monotone" dataKey="value" stroke="#3b82f6" strokeWidth={2} fillOpacity={1} fill="url(#colorEng)" />
                                                    </AreaChart>
                                                </ResponsiveContainer>
                                            </div>
                                            <div className="flex gap-2 mt-4 flex-wrap">
                                                {guard.tags.map((tag, i) => (
                                                    <span key={i} className="text-xs bg-slate-100 text-slate-600 px-2 py-1 rounded border border-slate-200">#{tag}</span>
                                                ))}
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            )}

                            {activeTab === 'financial' && <FinancialSimulator guard={guard} />}
                            
                            {activeTab === 'placement' && (
                                <div className="h-[500px] bg-white rounded-xl border border-slate-200 shadow-sm p-6">
                                    <AdvancedMap guard={guard} />
                                </div>
                            )}

                            {activeTab === 'history' && (
                                <div className="bg-white rounded-xl border border-slate-200 shadow-sm p-6 animate-fade-in">
                                    <h3 className="text-sm font-bold text-slate-800 mb-6">イベント・予兆タイムライン</h3>
                                    <Timeline history={guard.history} />
                                </div>
                            )}
                        </div>

                        {/* Footer Actions */}
                        <div className="p-6 bg-white border-t border-slate-200 shadow-[0_-4px_6px_-1px_rgba(0,0,0,0.05)] shrink-0 flex justify-between items-center z-10">
                            <div className="flex items-center gap-4">
                                <div className="bg-slate-100 p-2.5 rounded-lg text-slate-500">
                                    <Icon name="Send" size={18} />
                                </div>
                                <div>
                                    <div className="text-[10px] font-bold text-slate-400 uppercase tracking-wider">Next Step</div>
                                    <div className="text-sm font-bold text-slate-800">上長承認ワークフローを開始</div>
                                </div>
                            </div>
                            <div className="flex gap-3">
                                <button className="px-5 py-2.5 bg-white border border-slate-300 text-slate-700 rounded-lg text-sm font-bold hover:bg-slate-50 transition shadow-sm">
                                    一時保存
                                </button>
                                <button className="px-6 py-2.5 bg-blue-600 text-white rounded-lg text-sm font-bold hover:bg-blue-700 shadow-lg shadow-blue-200 transition flex items-center gap-2">
                                    <Icon name="CheckCircle" size={16} />
                                    方針を確定する
                                </button>
                            </div>
                        </div>
                    </div>
                </div>
            );
        };

        // --- Main Dashboard ---
        const Dashboard = () => {
            const [selectedGuard, setSelectedGuard] = useState(null);
            
            // Stats for Top Cards
            const stats = [
                { title: "要対応アラート", value: "3", unit: "名", trend: "+1", color: "red", icon: "AlertTriangle" },
                { title: "昇給推奨対象", value: "12", unit: "名", trend: "+4", color: "emerald", icon: "TrendingUp" },
                { title: "平均エンゲージメント", value: "68.4", unit: "pt", trend: "-2.1", color: "blue", icon: "Activity" },
                { title: "配置ミスマッチ", value: "8", unit: "件", trend: "0", color: "amber", icon: "MapPin" }
            ];

            return (
                <div className="flex h-screen bg-slate-50">
                    
                    {/* Sidebar (Visual Only) */}
                    <div className="w-64 bg-slate-900 text-slate-300 flex flex-col shrink-0">
                        <div className="p-6 flex items-center gap-3 text-white">
                            <div className="w-8 h-8 bg-gradient-to-br from-blue-500 to-indigo-600 rounded-lg flex items-center justify-center shadow-lg shadow-blue-900/50">
                                <Icon name="Brain" size={18} />
                            </div>
                            <span className="font-bold text-lg tracking-tight">AI Assess</span>
                        </div>
                        <nav className="flex-1 px-4 space-y-1">
                            <div className="px-2 py-2 text-xs font-bold text-slate-500 uppercase tracking-wider">Main</div>
                            <a href="#" className="flex items-center gap-3 px-4 py-3 bg-slate-800 text-white rounded-lg font-medium shadow-sm"><Icon name="LayoutDashboard" size={18} /> ダッシュボード</a>
                            <a href="#" className="flex items-center gap-3 px-4 py-3 hover:bg-slate-800/50 rounded-lg font-medium transition"><Icon name="Users" size={18} /> 従業員リスト</a>
                            <a href="#" className="flex items-center gap-3 px-4 py-3 hover:bg-slate-800/50 rounded-lg font-medium transition"><Icon name="BookOpen" size={18} /> 分析レポート</a>
                        </nav>
                        <div className="p-4 border-t border-slate-800">
                            <div className="flex items-center gap-3">
                                <div className="w-10 h-10 rounded-full bg-slate-700 flex items-center justify-center text-xs font-bold">YM</div>
                                <div>
                                    <div className="text-sm font-bold text-white">山田 太郎</div>
                                    <div className="text-xs text-slate-500">人事部 マネージャー</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    {/* Main Content */}
                    <div className="flex-1 flex flex-col overflow-hidden relative">
                        {/* Header */}
                        <header className="h-16 bg-white border-b border-slate-200 flex items-center justify-between px-8 z-10">
                            <div className="flex items-center gap-4 text-slate-400 text-sm font-medium">
                                <span>Home</span>
                                <Icon name="ChevronRight" size={14} />
                                <span className="text-slate-800">2026年1月 定期査定</span>
                            </div>
                            <div className="relative">
                                <Icon name="Search" className="absolute left-3 top-2.5 text-slate-400" size={16} />
                                <input type="text" placeholder="社員名、ID、タグで検索..." className="pl-10 pr-4 py-2 w-80 bg-slate-100 border-none rounded-full text-sm focus:ring-2 focus:ring-blue-500 focus:bg-white transition-all outline-none" />
                            </div>
                        </header>

                        {/* Scrollable Dashboard Area */}
                        <main className="flex-1 overflow-y-auto custom-scroll p-8">
                            
                            {/* Stats Cards */}
                            <div className="grid grid-cols-4 gap-6 mb-10">
                                {stats.map((stat, i) => (
                                    <div key={i} className="glass-panel p-6 rounded-2xl hover:shadow-lg transition-shadow duration-300">
                                        <div className="flex justify-between items-start mb-4">
                                            <div className={`p-3 rounded-xl ${
                                                stat.color === 'red' ? 'bg-red-50 text-red-600' :
                                                stat.color === 'emerald' ? 'bg-emerald-50 text-emerald-600' :
                                                stat.color === 'blue' ? 'bg-blue-50 text-blue-600' : 'bg-amber-50 text-amber-600'
                                            }`}>
                                                <Icon name={stat.icon} size={22} />
                                            </div>
                                            <span className={`text-xs font-bold px-2 py-1 rounded-full ${stat.trend.startsWith('+') ? 'bg-slate-100 text-slate-600' : 'bg-red-50 text-red-600'}`}>
                                                {stat.trend} vs先月
                                            </span>
                                        </div>
                                        <div className="text-3xl font-bold text-slate-800 mb-1">
                                            {stat.value}<span className="text-sm font-normal text-slate-400 ml-1">{stat.unit}</span>
                                        </div>
                                        <div className="text-xs font-bold text-slate-400 uppercase tracking-wide">{stat.title}</div>
                                    </div>
                                ))}
                            </div>

                            {/* Data Table Section */}
                            <div className="bg-white rounded-2xl border border-slate-200 shadow-sm overflow-hidden">
                                <div className="p-6 border-b border-slate-100 flex justify-between items-center">
                                    <h2 className="text-lg font-bold text-slate-800 flex items-center gap-2">
                                        <Icon name="Filter" size={18} className="text-slate-400" />
                                        査定対象リスト
                                    </h2>
                                    <div className="flex gap-2">
                                        <button className="px-3 py-1.5 text-xs font-bold text-slate-600 bg-slate-50 rounded hover:bg-slate-100 transition">条件保存</button>
                                        <button className="px-3 py-1.5 text-xs font-bold text-white bg-slate-800 rounded shadow hover:bg-slate-700 transition">CSVエクスポート</button>
                                    </div>
                                </div>
                                <table className="w-full text-left">
                                    <thead className="bg-slate-50 border-b border-slate-200 text-xs text-slate-500 uppercase font-semibold tracking-wider">
                                        <tr>
                                            <th className="p-5 pl-8">氏名 / 属性</th>
                                            <th className="p-5">リスク分析</th>
                                            <th className="p-5">パフォーマンス指標</th>
                                            <th className="p-5">AI推奨アクション</th>
                                            <th className="p-5 text-center">Action</th>
                                        </tr>
                                    </thead>
                                    <tbody className="divide-y divide-slate-100 text-sm">
                                        {MOCK_GUARDS.map((guard) => (
                                            <tr key={guard.id} onClick={() => setSelectedGuard(guard)} className="hover:bg-blue-50/40 transition-colors cursor-pointer group">
                                                <td className="p-5 pl-8">
                                                    <div className="flex items-center gap-4">
                                                        <div className={`w-10 h-10 rounded-full flex items-center justify-center text-white font-bold text-sm shadow-md ${guard.avatarColor}`}>
                                                            {guard.name[0]}
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-slate-800 text-base">{guard.name}</div>
                                                            <div className="text-xs text-slate-500 mt-0.5 font-medium">{guard.rank} | {guard.age}歳</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="space-y-2">
                                                        <Badge color={guard.riskLevel === 'high' ? 'red' : guard.riskLevel === 'medium' ? 'amber' : 'emerald'}>
                                                            {guard.riskReason}
                                                        </Badge>
                                                        <div className="flex gap-1 flex-wrap">
                                                            {guard.tags.map((t, i) => <span key={i} className="text-[10px] text-slate-500 bg-slate-100 px-1.5 py-0.5 rounded border border-slate-200">#{t}</span>)}
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="flex gap-6 items-center">
                                                        <div className="text-center">
                                                            <div className="text-[10px] text-slate-400 mb-1">収益</div>
                                                            <div className={`font-bold tabular-nums ${guard.metrics.profit < 70 ? 'text-red-500' : 'text-slate-700'}`}>{guard.metrics.profit}</div>
                                                        </div>
                                                        <div className="w-px h-8 bg-slate-100"></div>
                                                        <div className="text-center">
                                                            <div className="text-[10px] text-slate-400 mb-1">熱意</div>
                                                            <div className={`font-bold tabular-nums ${guard.metrics.engagement < 50 ? 'text-amber-500' : 'text-emerald-500'}`}>{guard.metrics.engagement}</div>
                                                        </div>
                                                        <div className="w-24 h-8">
                                                            {/* Micro Sparkline */}
                                                            <ResponsiveContainer width="100%" height="100%">
                                                                <AreaChart data={guard.metrics.history_engagement}>
                                                                    <Area type="monotone" dataKey="value" stroke={guard.riskLevel === 'high' ? '#ef4444' : '#3b82f6'} strokeWidth={2} fill="none" />
                                                                </AreaChart>
                                                            </ResponsiveContainer>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="p-5">
                                                    <div className="flex items-center gap-3">
                                                        <div className={`w-8 h-8 rounded-full flex items-center justify-center shrink-0 ${
                                                            guard.aiAction.type === 'placement' ? 'bg-amber-100 text-amber-600' : 
                                                            guard.aiAction.type === 'skill' ? 'bg-emerald-100 text-emerald-600' : 
                                                            'bg-blue-100 text-blue-600'
                                                        }`}>
                                                            <Icon name={guard.aiAction.type === 'placement' ? 'MapPin' : guard.aiAction.type === 'skill' ? 'BookOpen' : 'DollarSign'} size={14} />
                                                        </div>
                                                        <div>
                                                            <div className="font-bold text-slate-700">{guard.aiAction.label}</div>
                                                            <div className="text-xs text-slate-500 truncate max-w-[200px]">{guard.aiAction.detail}</div>
                                                        </div>
                                                    </div>
                                                </td>
                                                <td className="p-5 text-center">
                                                    <button className="w-8 h-8 rounded-full hover:bg-slate-100 flex items-center justify-center text-slate-400 hover:text-blue-600 transition">
                                                        <Icon name="ArrowRight" size={16} />
                                                    </button>
                                                </td>
                                            </tr>
                                        ))}
                                    </tbody>
                                </table>
                            </div>
                        </main>
                        
                        {/* Detail Drawer Injection */}
                        {selectedGuard && <DetailDrawer guard={selectedGuard} onClose={() => setSelectedGuard(null)} />}
                    </div>
                </div>
            );
        };

        const root = ReactDOM.createRoot(document.getElementById('root'));
        root.render(<Dashboard />);
    </script>
</body>
</html>
